test_name: react endpoint

stages:
  - name: Make sure that GET requests are disabled
    request:
      url: http://localhost:9000/api/v1/react/thesis-report
      method: GET
    response:
      status_code: 405
      headers:
        content-type: text/html

  - name: Make sure that invalid reaction types are not handled
    request:
      url: http://localhost:9000/api/v1/react/schmu
      method: POST
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        error: "There was a server error."

  - name: Make sure that thesis reports are handled
    request:
      url: http://localhost:9000/api/v1/react/thesis-report
      method: POST
      json:
        thesis_id: WOM-001-01
        uuid: test-uuid
        text: test-text
    response:
      status_code: 200
      headers:
        content-type: application/json

  - name: Make sure that thesis reports missing thesis id return an error
    request:
      url: http://localhost:9000/api/v1/react/thesis-report
      method: POST
      json:
        uuid: test-uuid
        text: test-text
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        error: "There was a server error."

  - name: Make sure that thesis reports missing uuid return an error
    request:
      url: http://localhost:9000/api/v1/react/thesis-report
      method: POST
      json:
        thesis_id: WOM-001-01
        text: test-text
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        error: "There was a server error."

  - name: Make sure that new reactions are handled
    request:
      url: http://localhost:9000/api/v1/react/reaction
      method: POST
      json:
        thesis_id: WOM-001-01
        uuid: test-uuid
        kind: 1
    response:
      status_code: 200
      headers:
        content-type: application/json
      save:
        body:
          reaction_count: data

  - name: Make sure that duplicate reactions are handled
    request:
      url: http://localhost:9000/api/v1/react/reaction
      method: POST
      json:
        thesis_id: WOM-001-01
        uuid: test-uuid
        kind: 1
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        data:
          "1": 1


  - name: Make sure that reactions missing thesis id return an error
    request:
      url: http://localhost:9000/api/v1/react/reaction
      method: POST
      json:
        uuid: test-uuid
        kind: 1
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        error: "There was a server error."

  - name: Make sure that reactions missing uuid return an error
    request:
      url: http://localhost:9000/api/v1/react/reaction
      method: POST
      json:
        thesis_id: WOM-001-01
        kind: 1
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        error: "There was a server error."

  - name: Make sure that reactions missing rating return an error
    request:
      url: http://localhost:9000/api/v1/react/reaction
      method: POST
      json:
        thesis_id: WOM-001-01
        uuid: test-uuid
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        error: "There was a server error."
